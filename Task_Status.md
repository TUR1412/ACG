# [ACG-001] 任务看板
> **环境**: Windows 11 (pwsh -NoLogo -NoProfile wrapper) | **框架**: Astro + Tailwind + TypeScript | **档位**: 3档 (标准工程)
> **已激活矩阵**: [模块 A: 视觉矫正] + [模块 E: 幽灵防御] + [模块 B: 逻辑直通]

## 1. 需求镜像 (Requirement Mirroring)
> **我的理解**: 做一个“伪全栈”的二次元资讯小站：数据由 GitHub Actions 每小时抓取更新，站点静态部署到 GitHub Pages；UI 中日双语；支持搜索、收藏、已读与抓取状态页。
> **不做什么**: 不要求你本地常驻运行服务；不做登录/数据库；“全文预览”属于实验能力（阅读模式抓取 + 翻译 + 本地缓存），不做永久存储，也不保证每个来源都能稳定抓取。

## 2. 进化知识库 (Evolutionary Knowledge - Ω)
- [!] 抓取属于高风险行为：默认做“来源失败不影响全站”，并提供 `/status` 观测面板。
- [!] 为避免每小时自动提交刷屏：历史数据默认从已部署站点的 `data/posts.json` 回读并合并。

## 3. 执行清单 (Execution)
- [x] 1. 初始化 Astro + Tailwind + React 集成
- [x] 2. 完成中日双语路由与文案
- [x] 3. 编写抓取脚本与来源适配（RSS/Atom/RDF + HTML）
- [x] 4. 实现首页/分类/详情/收藏/状态页 + 本地状态（收藏/已读/搜索）
- [x] 5. 配置 GitHub Actions 每小时同步并部署到 Pages
- [x] 6. 本地构建验证 + README/License

## 4. 持续迭代 (Iteration)
- [x] 7. Actions 抓取缓存恢复（降低来源压力）
- [x] 8. 收藏导入/导出/清空（localStorage）
- [x] 9. 新增关于页（机制说明 + 来源列表）
- [x] 10. 关注关键词 + 屏蔽关键词（只看关注 / 隐藏已读）
- [x] 11. 今日快报一键复制
- [x] 12. 来源开关 + 未读计数 + 状态页可行动建议
- [x] 13. 视觉升级：图片卡片网格 + Bento 首页 + 雷达 Logo + 详情页封面头图
- [x] 14. 交互增强：Toast 反馈 + 快捷键搜索 + 空状态引导 + 回到顶部
- [x] 15. 缺图治理：文章页 og:image/tw:image 补全（可配置“偏激进”参数）
- [x] 16. 补图再增强：支持 JSON-LD / Lazyload 图片解析 + Miss TTL（减少重复抓取）
- [x] 17. 体验与排版：过滤节流 + 轻玻璃卡片 + 书签页按需渲染 + 标题断行优化 + 版心拓宽
- [x] 18. 质变升级：Spotlight 封面轮播（样式 + 按钮/点阵 + 键盘/拖拽交互）
- [x] 19. 缺图与卡顿：统一封面占位（含加载失败回退）+ 噪点层性能优化（替换 feTurbulence）
- [x] 20. 顺滑与观感：顶栏移动端降级 blur（桌面保留）+ 今日快报图文化（复制逻辑仍只取标题）
- [x] 21. 移动端与交互：底部导航（含 safe-area）+ 搜索直达（/#search 聚焦）+ 快捷筛选 Chip
- [x] 22. 缺图再增强：封面失败自愈重试（https 升级 / referrer 放宽 / cache bust）+ Bookmarks 占位统一
- [x] 23. 文档美化：README 增加徽章/架构图/路线图，并同步封面补全参数说明
- [x] 24. 缺图质变：封面占位“先出现后淡出”+ http 封面自动走 https 代理（避免混合内容）+ 失败兜底代理重试
- [x] 25. 体验与性能：小屏阴影降级 + 触控设备禁用 hover 上浮（更顺滑）
- [x] 26. 品牌与可读性：favicon/theme-color + README Banner + 缺图兜底策略说明 + Roadmap 对齐
- [x] 27. 新鲜度标记：近 6 小时显示 NEW/新着（已读自动停动画）
- [x] 28. 订阅流：关注来源（★）+ 只看关注源过滤 + Preferences 来源按分类分组
- [x] 29. 移动端质变：偏好设置抽屉化（不再拖长页面，按钮一键打开/关闭）
- [x] 30. 图标系统升级：新增 search/clock/chart/info/sliders，并统一底部导航与搜索框图标
- [x] 31. 顺滑优化：content-visibility 降离屏渲染 + 限制首屏入场数 + 触控禁用扫光 + 底栏 blur 降级
- [x] 32. 多语言可读性：抓取侧预生成中/日翻译字段（标题/摘要/预览），列表与轮播按语言优先展示翻译
- [x] 33. “全文预览”质变：详情页自动加载全文（r.jina.ai 阅读模式）并自动翻译到当前语言，支持原文/翻译切换与本地缓存
- [x] 34. 设备分级适配：手机/平板/桌面自适应（修复“手机被渲染成 PC 布局”）+ 移动端快报横滑化 + 固定层性能降级（更顺滑）
- [x] 35. 适配修复：提升设备识别鲁棒性（phone 阈值提升至 640 + coarse/hover 判定）+ 识别脚本 head-inline 早执行 + `?debug=1` 设备信息面板（锁定机型适配问题）
- [x] 36. 适配再加固：短边 shortSide 取多来源的最小有效值（避免 `window.screen` 报大数导致误判）
- [x] 37. Spotlight 体验升级：控件改为“嵌入式”底部浮层（更像 App）+ 顶部提示去掉 ←/→ 符号感
- [x] 38. 图标质感增强：少量浮层按钮启用 `acg-icon-fab` 玻璃效果（轮播/详情页，不影响大列表性能）
- [x] 39. 全文预览交互修复：当正文过长导致 localStorage 缓存被跳过时，仍可在本次会话正常「查看原文/查看翻译」切换
- [x] 40. 全文预览可读性：支持 Markdown 渲染（标题/列表/链接/引用/代码/图片），并提供 `acg-prose` 排版样式
- [x] 41. 文案对齐：将首页“最新”更名为“新闻动态”（日文为「ニュース」）
- [x] 42. 全文预览排版质变：支持粗体/斜体（修复 `_标题_` 下划线观感）+ 新闻列表卡片化 + 时间/日期徽标前缀（更像资讯 App）
- [x] 43. 全文预览再强化：段落“软换行合并”（文章不再一行一行断开）+ 目录页按 H4 自动分区折叠（含条目计数）+ 451 自动切换备用解析（AllOrigins + 本地 HTML 抽取）
- [x] 44. 全文预览图文化：纯链接自动卡片化 + “直链图片/Inside 图片页链接”自动转图片预览（减少一屏全是 URL 的尴尬）
- [x] 45. 链接再压缩：把 `[https://...](https://...)` / `[1](图片页)` 这类 Markdown 链接也自动转为链接卡片/图片预览（Inside 文章页更“像内容”）
- [x] 46. 链接去重聚合：列表里出现“标题 + inside-games.jp URL 卡片”的条目，自动合并成单条可点击嵌入（去掉重复 URL 行/孤立括号，信息密度更高）
- [x] 47. 全分区覆盖：链接去重聚合不再只限列表项，扩展到更多正文结构（避免不同分区/不同来源同类问题漏网）
- [x] 48. 聚合再增强：允许“标题链接 + URL卡片(尾部编码括号噪音)”这种变体，按目的地去重并优先选干净 href；同时隐藏 index 列表的 dot 前缀避免双点
- [x] 49. 全文预览净化：URL 尾部全角/编码标点清洗 + `@@ACGTOKEN` 占位符兜底清除 + 孤立括号/纯数字噪音剔除 + 文章/目录判定修正（避免文章页误判成目录卡片）
- [x] 50. Spotlight 轮播交互修复：触控端不再误判“轻微抖动”为拖拽导致点击打不开；左右切换控件改为两侧竖条玻璃（更像 App，减少遮挡）
- [x] 51. 全文预览排版再增强：图片最大高度限制 + 连续图片段落/纯图片列表自动合并为画廊网格（避免“大图淹没正文”）
- [x] 52. 全文预览稳定性：Jina “目录 dump”质量门槛 + CodeTabs 备用解析 + ANN 主容器优先提取 + 文章自身 URL 噪音剔除
- [x] 53. 全文预览根因修复：正文容器选择不再误选 `body`（避免把导航/侧栏吞进全文导致“满屏杂乱链接”）
- [x] 54. 全站级修复：全文缓存版本升级 + 自动剔除“错误正文缓存”并迁移旧缓存（避免所有页面都要手动重载）
- [x] 55. 全文预览更激进去噪：文章页删除“纯链接/提示型段落/列表条目”+ 高链接密度推荐块剥离（正文更干净）
- [x] 56. 全文预览结构化：HTML 抽取补齐 `figure/figcaption` 转换（图注与图片关系更稳定）
- [x] 57. 全文预览图墙治理：画廊合并支持“忽略/删除无意义段落”（如点击放大/空白占位），更容易收敛为网格
- [x] 58. 设备识别再加固：touch 设备默认 phone（UA tablet 例外），修复手机仍显示 PC 视图与卡顿
- [x] 59. ANN 脏数据修复：清理 `[[label](url)]]` 这类多括号链接（图片 credit 不再出现 `]]` 杂质）
- [x] 60. 全文预览缺图再修复：HTML 抽取优先 `data-src/srcset`，跳过 `/img/spacer.gif` 等占位图（正文图片可见）
- [x] 61. 图注更完整：`figure` 同时提取多个 `figcaption`（credit + copyright）并以引用块展示
- [x] 62. 缓存自愈：检测 ANN 正文含 `/img/spacer.gif` 占位图则判定缓存失效并自动重新抓取（避免用户手动重载）
- [x] 63. 全文预览再净化：ANN 图注默认忽略（credit/copyright/多括号杂质不再污染正文）+ 文章页短“Source/Via/©”段落自动剥离
- [x] 64. 全文预览阅读体验：文章模式下纯 URL 不再卡片化（降噪且更像文章）
- [x] 65. 抽取稳定性：媒体 iframe 替换避免 `<p>` 嵌套（降低 DOM 结构变形风险）
- [x] 66. IID 系（Inside/AnimeAnime）清壳补强：移除 `.pickup-text-list/.main-pickup/.main-ranking/#_popIn_recommend` 等导流模块
- [x] 67. Spotlight 轮播业务修复：桌面端点击封面兜底跳转（避免滚动容器吞掉 click 导致“点了没反应”）
- [x] 68. 缓存穿透：全文缓存版本升级至 `acg.fulltext.v5`（线上用户无需手动重载即可获得新规则）
- [x] 69. 来源覆盖扩展：为 `natalie.mu` 添加正文容器优先级（`.NA_article_body`），避免吞掉“相关人物/标签”图墙
- [x] 70. 缺图治理再增强：HTML→Markdown 支持 block-level `<img>`（修复 natalie 等站点正文图不在 `figure/p` 内导致的缺图）
- [x] 71. ナタリー去壳：移除“関連記事/タグ/大图查看提示/评分信息”等非正文模块
- [x] 72. 全文预览根因再修：识别 Jina/代理返回的 JSON 拦截体（如 `code:451/SecurityCompromiseError`），拒绝当正文渲染并自动走后备解析
- [x] 73. 全文预览更激进：识别“整页壳 dump”（导航/页脚/Logo 菜单混入）并判失败，避免满屏杂链/大图
- [x] 74. 站点策略：对 `inside-games.jp / animeanime.jp / otakumode.com` 跳过 Jina 优先走 HTML 抽取（减少卡顿与噪音）
- [x] 75. TOM（otakumode.com）适配：正文容器优先 `.p-article__text/.p-article__body` + 评论/工具栏硬截断 + 去壳选择器
- [x] 76. 追踪像素治理：HTML 抽取阶段删除 1x1/2x2 像素与已知 user-sync 域名；Markdown 归一化阶段清理追踪图行
- [x] 77. 缓存穿透：全文缓存版本升级至 `acg.fulltext.v6`（保证线上立即吃到新净化规则）
- [x] 78. 移动端紧急修复：设备识别增加 `matchMedia(pointer/hover)` 兜底，降低“手机在桌面站点下被渲染成 PC”概率
- [x] 79. 横滑体验补强：`acg-hscroll` 在 tablet/phone 设备分级下强制横向可滑（避免断点导致换行不可滑）
- [x] 80. Spotlight 控件再收敛：左右切换改为更弱干扰的侧边竖条（减少遮挡与突兀感）
- [x] 81. 移动端终极兜底：加入纯 CSS 触控媒体特征覆盖（即使 JS/断点失真也强制走移动端单栏与可滑节奏）
- [x] 82. 首屏性能：列表搜索/筛选改为“惰性初始化 + idle 构建索引”，避免首页/分类页 DOMContentLoaded 卡一下
- [x] 83. 滚动性能：移除底部导航固定层的 `backdrop-filter`，并把 NEW 脉冲从 box-shadow 改为 transform/opacity（显著减少重绘）
- [x] 84. 移动端再加固：纯 CSS 兜底覆盖扩展到 `any-pointer/any-hover` + 触控设备强制显示底部导航（避免“手机像 PC”）
