# 变更提案: UI 进化（Accent / 视图预设 / 深链分享 / Cmdk 扩展）

## 需求背景

本仓库面向 GitHub Pages 的“静态站 + 定时同步”模式，页面体验高度依赖前端交互与可视化反馈。随着信息源规模与交互入口增多，现有 UI 需要更强的个性化能力（视觉偏好、视图场景复用、可分享深链）与更可靠的错误兜底，以保证在不同设备/网络条件下仍保持“轻、快、稳”的阅读体验。

本次变更聚焦在“不引入臃肿依赖”的前提下，强化以下能力：

1. 视觉系统可配置（强调色/氛围）并持久化；
2. 视图场景可保存/复用/分享（View Presets）；
3. 深链可复现（复制出来的链接打开后能还原视图状态）；
4. 键盘路径强化（Cmdk 直接应用视图预设/切换强调色）。

## 变更内容

1. 新增 Accent（强调色）模式：`neon/sakura/ocean/amber`
2. 新增 View Presets（视图预设）：保存/应用/重命名/删除/复制链接
3. 深链增强：URL 携带视图快照参数时，页面可自动应用并清理 URL
4. Cmdk 增强：新增强调色切换与视图预设应用入口

## 影响范围

- **模块:**
  - client-app（浏览器端交互与偏好）
  - web-ui（偏好面板与交互入口）
- **文件:**
  - `src/client/app.ts`
  - `src/client/constants.ts`
  - `src/client/features/cmdk.ts`
  - `src/components/organisms/PreferencesPanel.astro`
  - `src/styles/global.css`
- **数据:**
  - localStorage（新增 key）

## 核心场景

### 需求: 强调色（Accent）个性化

**模块:** client-app / web-ui

#### 场景: 用户希望站点在不同设备上保持一致的视觉风格

- 预期结果：可在偏好面板选择强调色；刷新后仍保持；全站 UI（含背景氛围）随强调色联动。

### 需求: 视图预设（View Presets）

**模块:** client-app / web-ui

#### 场景: 用户希望保存一套常用“筛选 + 布局 + 主题/强调色”并一键复用

- 预期结果：偏好面板可保存当前视图为预设；预设可重命名/删除；可一键应用。

#### 场景: 用户希望将某个视图分享给他人或跨设备打开

- 预期结果：可复制“视图链接”；他人打开后可自动还原视图快照。

### 需求: 键盘路径（Cmdk）增强

**模块:** client-app

#### 场景: 重度用户希望不离开键盘完成“切换强调色 / 应用视图预设”

- 预期结果：Cmdk 中可搜索并执行强调色切换与视图预设应用；无需滚动到偏好面板。

## 风险评估

- **风险:** URL 深链自动应用可能覆盖用户当前偏好，导致“刷新后又被覆盖”的困扰  
  **缓解:** 自动应用后立即清理 URL 中的快照参数，避免返回/刷新重复覆盖；同时保持 `?q=` 老链接仅应用搜索，不强制重置其他偏好。
- **风险:** localStorage 不可用（隐私模式/禁用）导致异常  
  **缓解:** 全部读写均使用 try/catch 容错；UI 功能在不可写时自动降级为“仅当前会话有效”。
