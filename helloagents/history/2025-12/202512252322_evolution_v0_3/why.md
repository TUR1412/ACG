# 变更提案: evolution_v0_3（视觉系统重构 + 交互逻辑进化 + 功能矩阵补强）

## 需求背景
当前站点已具备“玻璃拟态 + 本地优先交互”的产品雏形，但视觉系统仍偏“局部手工调参”，缺少统一的设计令牌（栅格/阴影/排版尺度）来支撑持续演进；同时搜索/筛选与交互反馈仍以“功能可用”为主，缺少可组合的高级筛选语义与可观测的行为埋点（本地优先）。

本次演进以“静态站点低运维”不变为前提，强化视觉系统一致性与交互体验（转场/骨架/反馈），并补齐筛选、预取与可观测能力。

## 产品分析

### 目标用户与场景
- **用户群体:** ACG 资讯高频浏览者（移动端为主），以及希望离线/弱网可用的读者
- **使用场景:** 快速扫读最新、分类浏览、收藏回看、弱网环境打开站点
- **核心痛点:** 视觉一致性不足（缺少统一令牌）；筛选语义不够强（难以组合条件）；缺乏对关键交互的可观测能力（无法定位体验瓶颈）

### 价值主张与成功指标
- **价值主张:** 用“令牌化视觉系统 + 轻量动效 + 可组合筛选 + 本地埋点”让站点更像商业级资讯 App。
- **成功指标:**
  - 视觉：统一 12 列栅格（gutter/gap 令牌）、12 级阴影层级、黄金比例排版尺度
  - 交互：支持 View Transitions 转场并提供 WAAPI 降级；收藏页骨架屏更自然
  - 功能：搜索支持多级语法（tag/source/cat/before/after/is）；新增本地优先埋点与可选上报

### 人文关怀
- 默认不上传任何行为数据，仅在用户显式开启并配置 endpoint 后才尝试上报；避免无意泄露隐私。

## 变更内容
1. 建立视觉令牌：12 列栅格（gutter/gap）、12 级阴影层级、黄金比例字体/行高尺度
2. 升级玻璃拟态：为主要容器增加动态渐变边框与 hover 动效，封面占位加入 SVG 路径绘制动效
3. 交互进化：View Transitions 动效（CSS）+ WAAPI 降级，骨架屏 shimmer
4. 功能矩阵补强：多级筛选语法、搜索预取（索引惰性初始化）、用户行为埋点（本地优先）与网络重试抖动（jitter）

## 影响范围
- **模块:**
  - web-ui
  - client-app
- **文件:**
  - `tailwind.config.ts`
  - `src/styles/global.css`
  - `src/layouts/SiteLayout.astro`
  - `src/pages/**`
  - `src/components/**`
  - `src/client/app.ts`
  - `src/client/utils/http.ts`
  - `src/client/utils/telemetry.ts`
  - `helloagents/wiki/*`

## 核心场景

### 需求: 高级筛选语义
**模块:** client-app
场景：用户希望组合筛选条件快速定位内容。
- 预期结果：支持 `tag:` / `source:` / `cat:` / `before:` / `after:` / `is:` 等语法，并与关注词/屏蔽词/已读过滤/来源开关协同工作。

### 需求: 转场与反馈
**模块:** web-ui + client-app
场景：页面切换更顺滑，弱网/加载中不“空白发呆”。
- 预期结果：支持 View Transitions（有动效且可降级）；收藏页骨架屏 shimmer；Toast 继续作为统一反馈通道。

## 风险评估
- **风险:** 玻璃容器的动态渐变边框若“常驻动画”可能带来合成压力
- **缓解:** 仅在 hover 时启动动画；大列表仍避免 backdrop-filter（保留 `glass-card` 的性能策略）

