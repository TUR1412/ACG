# 变更提案: evolution_v0_2（可维护性与可用性升级）

## 需求背景
现有项目已经具备较强的“低运维资讯雷达”能力，但在以下方面仍有进一步提升空间：
- 来源配置的“站点侧引用”与“同步脚本侧引用”存在耦合，后续扩展订阅导出（OPML/JSON Feed）与来源列表维护会产生重复与不一致风险。
- 缺少弱网/离线体验兜底，移动端与跨网络场景下的可用性还有提升空间。
- CI 目前以“能构建/能部署”为主，缺少对数据质量与产物体积的硬性门禁，容易出现“悄悄劣化”的长期风险。

## 变更内容
1. 建立来源配置 SSOT：来源列表与筛选规则集中在 `src/lib/source-config.ts`，脚本与页面共同消费。
2. 增加订阅导出能力：提供 OPML 与 JSON Feed（中日双语路径一致）。
3. 引入 PWA 基础：增加 Manifest 与 Service Worker，优化离线/弱网体验。
4. 引入质量门禁：同步产物校验（结构/不变量）与构建体积预算（dist 体积与关键资源）在 CI 中强制执行。

## 影响范围
- 模块：
  - pipeline-sync（同步脚本）
  - web-ui（订阅导出页面）
  - client-app（PWA 注册与缓存）
  - shared-lib（来源配置）
- 文件：
  - `src/lib/source-config.ts`（新增）
  - `scripts/sources/index.ts`（改造为从 SSOT 读取）
  - `src/pages/*`（新增 OPML/JSON Feed；About 页解耦）
  - `.github/workflows/*`（新增质量门禁步骤）
  - `public/*`（新增 PWA 资源）

## 核心场景

### 需求: 来源配置 SSOT
模块: shared-lib
场景: 新增/调整来源时，不需要同时修改 scripts 与页面，避免不一致。
- 预期结果: 来源配置仅维护一份；脚本与页面均引用同一导出。

### 需求: 订阅导出（OPML/JSON Feed）
模块: web-ui
场景: 用户希望在阅读器中导入全部来源，或以程序方式消费信息流。
- 预期结果: 通过 OPML 一键导入；通过 JSON Feed 获取结构化订阅内容。

### 需求: 弱网/离线兜底（PWA）
模块: client-app
场景: 用户在弱网/离线时仍希望打开站点与最近访问的数据文件。
- 预期结果: Service Worker 提供缓存与回退策略，不影响在线体验。

### 需求: CI 质量门禁
模块: pipeline-sync
场景: 某个来源结构变更导致生成数据异常，或产物体积异常膨胀。
- 预期结果: CI 阻断部署并输出明确错误，避免问题悄然上线。

## 风险评估
- 风险：Service Worker 缓存策略不当可能造成旧资源驻留（“缓存污染”）。
  - 缓解：使用显式版本号与 activate 清理旧缓存；对导航请求采用 network-first。
- 风险：订阅导出格式不兼容部分阅读器。
  - 缓解：遵循 OPML 2.0 与 JSON Feed 1.1 规范，字段保持保守与兼容。

