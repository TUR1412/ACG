# web-ui

## 目的
负责页面与组件的静态渲染，提供多语言路由、订阅导出与可访问的 UI 结构。

## 模块概述
- 职责：Astro 页面/组件渲染、RSS/JSON Feed/OPML 输出、SEO 元信息、布局与导航
- 状态：✅稳定
- 最后更新：2026-01-11

## 规范
### 需求: 订阅导出兼容
场景：用户希望将来源一键导入阅读器或程序消费信息流。
- 预期结果：提供 RSS（已有）+ JSON Feed + OPML，且中日双语路由一致。

### 需求: 视觉系统令牌化
场景：站点持续迭代时希望保持一致的排版、栅格与阴影层级，不再“每个页面手调一套”。
- 预期结果：栅格（gutter/gap）、排版尺度（黄金比例）与阴影层级（e1..e12）在全局可复用，并可通过 Tailwind utilities（如 `shadow-e*` / `text-phi-*` / `gap-grid` / `px-gutter`）与语义类（如 `.acg-grid-12` / `.acg-col-span-*` / `.acg-elev-*`）直接使用；玻璃与边框动效参数通过 CSS 变量统一调参；对低性能/省流量设备自动注入 `data-acg-perf="low"` 启用视觉降级，保证滚动与输入更稳定。

### 需求: 布局模式与信息密度（View/Density）
场景：用户希望在桌面端也能自由切换“网格卡片浏览”与“列表式高密度扫读”，并按场景选择更紧凑的排版密度。
- 预期结果：偏好设置中提供 View Mode（Grid/List）与 Density（Comfort/Compact）两组入口；默认保持现有网格与舒适密度。
- 实现要点：通过根节点 `data-acg-view` / `data-acg-density` 驱动样式覆盖（最小侵入），避免修改页面/组件的核心结构；切换仅影响表现层，不改变业务逻辑根基。

### 需求: 首页信号板与洞察
场景：首页首屏需要在不滚动的情况下给出趋势概览，并提供一键可执行的快捷动作。
- 预期结果：SignalBoard 汇总脉冲热榜、时间透镜计数、来源健康度与快捷动作（热度排序/稳定来源/去重视图），缺少数据时仍能提示状态与下一步。

### 需求: 卡片元信息与阅读节奏
场景：用户在信息流中需要快速判断“热度/阅读成本/重复量/来源可信度”。
- 预期结果：卡片显示热度分、预计阅读时长、重复计数与来源健康度徽章；在低性能模式下保持信息层级清晰、避免冗余动效。

### 需求: 无障碍与键盘路径
场景：键盘用户或使用辅助技术的用户希望快速跳过导航并进入主内容。
- 预期结果：提供 Skip Link（跳到主要内容），并为 `<main>` 提供稳定锚点 `id="main"`（可聚焦），与全局 `:focus-visible` 样式一致。

### 需求: 分类页首屏性能（体积）
场景：分类页静态渲染条目较多时，HTML 体积会显著上升并影响移动端加载/解析成本。
- 预期结果：分类页默认仅渲染“最新一段”（例如 60 条）以降低 HTML 体积；同时提供“一键切换到全站搜索并自动套用 `cat:<category>` 过滤”的入口，保证用户可达全量内容。

### 需求: 弹层与微交互一致性
场景：Toast / Command Palette 等浮层需要“商业级”视觉反馈，同时在低性能设备上避免不必要开销。
- 预期结果：命令面板支持分组标题、关键词高亮与滚动条样式；Toast 提供 variant 图标、hover 阴影与点击消失动画；在 `data-acg-perf="low"` 或滚动期 `data-acg-scroll="1"` 下自动禁用 backdrop blur 等高开销效果，并暂停 shimmer/占位动画以保证滚动稳定。

### 需求: 页面转场动效
场景：在页面跳转时获得更连贯的阅读节奏，并兼容不支持新 API 的浏览器。
- 预期结果：支持 View Transitions 动效；不支持时降级到 WAAPI 的淡入淡出，且遵循 prefers-reduced-motion；动效以 opacity/transform 为主，避免 filter blur 造成合成开销。

### 需求: 状态页可观测性（来源级）
场景：当来源偶发失败/解析波动时，需要在静态站内快速定位原因，而不依赖 CI 日志全文排查。
- 预期结果：`/status` 展示来源级重试指标（attempts/waitMs）与解析统计（raw/filtered），帮助快速判断“网络波动 vs 解析失效”。

### 需求: 状态页趋势（近 7/30 轮）
场景：单次 status 只能看到“这一轮”，但排障更需要趋势：偶发波动 vs 持续异常、来源停更 vs 抓取失败等。
- 预期结果：同步管线生成 `status-history.v1.json(.gz)`（回读上一轮并追加裁剪），`/status` 页面以静态 SVG sparkline + 指标卡展示近 7/30 轮趋势（成功率/异常来源数/新增条目）；历史不足时提示“至少需要 2 轮记录”。

## 依赖
- `tailwind.config.ts`
- `src/styles/global.css`
- `src/layouts/SiteLayout.astro`
- `src/pages/*`
- `src/components/*`
- `src/lib/feeds.ts`
- `src/lib/source-config.ts`

