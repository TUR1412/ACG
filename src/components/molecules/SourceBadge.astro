---
import Icon from "../atoms/Icon.astro";
import { safeExternalHttpUrl } from "../../lib/safe-url";

export type Tone = "light" | "dark";
export type Health = "excellent" | "good" | "warn" | "down";

export type Props = {
  name: string;
  url?: string;
  tone?: Tone;
  dotClass?: string;
  class?: string;
  compact?: boolean;
  health?: Health;
  healthLabel?: string;
};

const {
  name,
  url,
  tone = "light",
  dotClass,
  class: className,
  compact = false,
  health,
  healthLabel
} = Astro.props as Props;
const safeUrl = safeExternalHttpUrl(url);

const base =
  tone === "dark"
    ? "inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/10 text-white/90"
    : "inline-flex items-center gap-2 rounded-full border border-slate-900/10 bg-white/55 text-slate-700 hover:bg-white/75";

const size = compact ? "px-2.5 py-1 text-[11px]" : "px-3 py-1 text-xs";
const cls = [base, size, "clickable", className].filter(Boolean).join(" ");
const healthShort =
  health === "excellent"
    ? "A"
    : health === "good"
      ? "B"
      : health === "warn"
        ? "C"
        : health === "down"
          ? "D"
          : "";
---

{
  safeUrl ? (
    <a
      class={cls}
      href={safeUrl}
      target="_blank"
      rel="noreferrer noopener"
      title={name}
      data-source-badge="true"
      data-source-name={name}
    >
      {dotClass ? <span class:list={["size-1.5 rounded-full", dotClass]} /> : null}
      <span class="min-w-0 max-w-[20ch] acg-fade-truncate">{name}</span>
      {health ? (
        <span
          class:list={["acg-health-pill", `acg-health-${health}`]}
          title={healthLabel ?? ""}
          aria-label={healthLabel ?? ""}
        >
          <span class="acg-health-dot" aria-hidden="true" />
          <span class="acg-health-text">{healthShort}</span>
        </span>
      ) : null}
      <span class={tone === "dark" ? "text-white/80" : "text-slate-500"} aria-hidden="true">
        <Icon name="external-link" size={14} />
      </span>
    </a>
  ) : (
    <span class={cls} title={name} data-source-badge="true" data-source-name={name}>
      {dotClass ? <span class:list={["size-1.5 rounded-full", dotClass]} /> : null}
      <span class="min-w-0 max-w-[20ch] acg-fade-truncate">{name}</span>
      {health ? (
        <span
          class:list={["acg-health-pill", `acg-health-${health}`]}
          title={healthLabel ?? ""}
          aria-label={healthLabel ?? ""}
        >
          <span class="acg-health-dot" aria-hidden="true" />
          <span class="acg-health-text">{healthShort}</span>
        </span>
      ) : null}
    </span>
  )
}
