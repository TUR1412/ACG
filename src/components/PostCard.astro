---
import type { Post } from "../lib/types";
import type { Lang } from "../i18n/i18n";
import { categoryLabel } from "../lib/categories";
import { href } from "../lib/href";
import { formatDateTime, formatRelativeHours } from "../lib/format";

type Props = {
  post: Post;
  lang: Lang;
};

const { post, lang } = Astro.props;
const detailHref = href(`/${lang}/p/${post.id}/`);
const when = formatRelativeHours(lang, post.publishedAt) ?? formatDateTime(lang, post.publishedAt);
---

<article
  class="glass clickable group relative overflow-hidden rounded-2xl p-4"
  data-post-id={post.id}
  data-category={post.category}
  data-source-id={post.sourceId}
>
  <div class="flex items-start justify-between gap-3">
    <div class="min-w-0">
      <div class="flex flex-wrap items-center gap-2">
        <span class="rounded-full bg-slate-900/90 px-2 py-0.5 text-xs font-medium text-white">
          {categoryLabel(lang, post.category)}
        </span>
        <span class="text-xs text-slate-600">
          <a class="hover:underline" href={post.sourceUrl} target="_blank" rel="noreferrer">
            {post.sourceName}
          </a>
        </span>
        <span class="text-xs text-slate-500">{when}</span>
      </div>
      <a href={detailHref} class="mt-2 block text-base font-semibold text-slate-950 hover:underline">
        {post.title}
      </a>
    </div>

    <button
      type="button"
      class="glass rounded-xl px-3 py-2 text-xs font-medium text-slate-950 clickable"
      data-bookmark-id={post.id}
      aria-pressed="false"
    >
      <span data-bookmark-label>â˜†</span>
    </button>
  </div>

  {post.summary && <p class="mt-2 line-clamp-3 text-sm leading-relaxed text-slate-700">{post.summary}</p>}

  {post.tags?.length > 0 && (
    <div class="mt-3 flex flex-wrap gap-2">
      {post.tags.slice(0, 6).map((tag) => (
        <button
          type="button"
          class="rounded-full border border-slate-900/10 bg-white/50 px-2 py-1 text-xs text-slate-700 hover:bg-white/70 clickable"
          data-tag={tag}
          title="Filter"
        >
          {tag}
        </button>
      ))}
    </div>
  )}
</article>
