---
import SiteLayout from "../../layouts/SiteLayout.astro";
import { readGeneratedStatus } from "../../lib/generated-data";
import { formatDateTime } from "../../lib/format";
import { t } from "../../i18n/i18n";

const status = await readGeneratedStatus();
const updatedAt = status.generatedAt ? formatDateTime("zh", status.generatedAt) : "-";
---

<SiteLayout lang="zh" title={t("zh", "status.title")} currentPath="/status/">
  <div class="glass rounded-2xl p-5">
    <h1 class="m-0 text-2xl font-semibold text-slate-950">{t("zh", "status.title")}</h1>
    <p class="mt-2 text-sm text-slate-700">
      {t("zh", "status.lastRun")}: {updatedAt} · {status.durationMs}ms
    </p>
  </div>

  <div class="mt-4 glass rounded-2xl p-5">
    <h2 class="m-0 text-sm font-semibold text-slate-950">{t("zh", "status.sources")}</h2>
    <div class="mt-3 overflow-x-auto">
      <table class="w-full border-separate border-spacing-y-2 text-sm">
        <thead class="text-left text-xs text-slate-600">
          <tr>
            <th class="px-3">来源</th>
            <th class="px-3">状态</th>
            <th class="px-3">条目</th>
            <th class="px-3">HTTP</th>
            <th class="px-3">耗时</th>
          </tr>
        </thead>
        <tbody>
          {status.sources.map((s) => (
            <tr class="glass">
              <td class="px-3 py-2">
                <a class="font-medium text-slate-950 hover:underline" href={s.url} target="_blank" rel="noreferrer">
                  {s.name}
                </a>
                <div class="text-xs text-slate-600">{s.id}</div>
              </td>
              <td class="px-3 py-2">
                <span
                  class:list={[
                    "rounded-full px-3 py-1 text-xs font-medium",
                    s.ok ? "bg-emerald-500/15 text-emerald-800" : "bg-rose-500/15 text-rose-800"
                  ]}
                >
                  {s.ok ? t("zh", "status.ok") : t("zh", "status.error")}
                </span>
              </td>
              <td class="px-3 py-2">{s.itemCount}</td>
              <td class="px-3 py-2">{s.httpStatus ?? "-"}</td>
              <td class="px-3 py-2">{s.durationMs}ms</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </div>
</SiteLayout>
