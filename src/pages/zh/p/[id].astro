---
import SiteLayout from "../../../layouts/SiteLayout.astro";
import type { Post } from "../../../lib/types";
import { readGeneratedPosts } from "../../../lib/generated-data";
import { categoryLabel } from "../../../lib/categories";
import { formatDateTime } from "../../../lib/format";
import { t } from "../../../i18n/i18n";

export async function getStaticPaths() {
  const posts = await readGeneratedPosts();
  return posts.map((post) => ({ params: { id: post.id }, props: { post } }));
}

const { post } = Astro.props as { post: Post };
const published = formatDateTime("zh", post.publishedAt);
---

<SiteLayout lang="zh" title={post.title} currentPath={`/p/${post.id}/`} currentPostId={post.id}>
  <article class="glass rounded-2xl p-6">
    <div class="flex flex-wrap items-center gap-2">
      <span class="rounded-full bg-slate-900/90 px-3 py-1 text-xs font-medium text-white">
        {categoryLabel("zh", post.category)}
      </span>
      <a class="text-xs text-slate-700 hover:underline" href={post.sourceUrl} target="_blank" rel="noreferrer">
        {t("zh", "post.source")}: {post.sourceName}
      </a>
      <span class="text-xs text-slate-500">{t("zh", "post.publishedAt")}: {published}</span>
    </div>

    <h1 class="mt-4 text-2xl font-semibold leading-snug text-slate-950">{post.title}</h1>

    {post.tags?.length > 0 && (
      <div class="mt-3 flex flex-wrap gap-2">
        {post.tags.slice(0, 10).map((tag) => (
          <span class="rounded-full border border-slate-900/10 bg-white/50 px-3 py-1 text-xs text-slate-700">
            {tag}
          </span>
        ))}
      </div>
    )}

    {post.summary ? (
      <p class="mt-4 whitespace-pre-line text-sm leading-relaxed text-slate-800">{post.summary}</p>
    ) : (
      <p class="mt-4 text-sm text-slate-700">{t("zh", "common.noData")}</p>
    )}

    <div class="mt-6 flex flex-wrap gap-3">
      <a
        class="inline-flex rounded-xl bg-slate-900 px-4 py-2 text-sm font-medium text-white clickable"
        href={post.url}
        target="_blank"
        rel="noreferrer"
      >
        {t("zh", "post.openSource")}
      </a>
      <button
        type="button"
        class="glass inline-flex items-center rounded-xl px-4 py-2 text-sm font-medium text-slate-950 clickable"
        data-bookmark-id={post.id}
        aria-pressed="false"
      >
        <span data-bookmark-label>â˜†</span>
        <span class="ml-2">{t("zh", "nav.bookmarks")}</span>
      </button>
    </div>
  </article>
</SiteLayout>
