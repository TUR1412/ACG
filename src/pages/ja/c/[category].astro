---
import SiteLayout from "../../../layouts/SiteLayout.astro";
import PostList from "../../../components/PostList.astro";
import PreferencesPanel from "../../../components/PreferencesPanel.astro";
import { readGeneratedPosts } from "../../../lib/generated-data";
import { CATEGORIES, categoryLabel, type Category } from "../../../lib/categories";
import { getCategoryTheme } from "../../../lib/category-theme";
import { t } from "../../../i18n/i18n";

export function getStaticPaths() {
  return CATEGORIES.map((category) => ({ params: { category } }));
}

const posts = await readGeneratedPosts();
const category = Astro.params.category as Category;
const filtered = posts.filter((p) => p.category === category).slice(0, 120);
const theme = getCategoryTheme(category);
---

<SiteLayout
  lang="ja"
  title={categoryLabel("ja", category)}
  currentCategory={category}
  currentPath={`/c/${category}/`}
>
  <section class="grid gap-4 md:grid-cols-12">
    <div class="glass relative overflow-hidden rounded-2xl p-6 md:col-span-8">
      <div class="pointer-events-none absolute inset-0">
        <div class:list={["absolute -left-24 -top-24 h-72 w-72 rounded-full blur-3xl", theme.glow]}></div>
        <div class="absolute -right-24 -bottom-24 h-72 w-72 rounded-full bg-slate-900/5 blur-3xl"></div>
      </div>

      <div class="relative flex flex-wrap items-end justify-between gap-4">
        <div>
          <h1 class="m-0 text-2xl font-semibold text-slate-950">{categoryLabel("ja", category)}</h1>
          <p class="mt-1 text-xs text-slate-600">{t("ja", "nav.latest")} · {filtered.length} 件</p>
        </div>

        <div class="flex flex-wrap items-center gap-2 text-xs text-slate-700">
          <span class="glass rounded-full px-3 py-1">
            {t("ja", "search.result")} <span id="acg-search-count">-</span>
          </span>
          <span class="glass rounded-full px-3 py-1">
            {t("ja", "home.unread")} <span id="acg-unread-count">-</span>
          </span>
        </div>
      </div>

      <div class="relative mt-4">
        <label class="sr-only" for="acg-search">{t("ja", "search.placeholder")}</label>
        <div class="relative">
          <div class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-slate-500">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path
                d="M10.5 19a8.5 8.5 0 1 1 0-17 8.5 8.5 0 0 1 0 17Z"
                stroke="currentColor"
                stroke-width="2"
              />
              <path
                d="M21 21l-4.3-4.3"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
          </div>
          <input
            id="acg-search"
            class="w-full rounded-xl border border-slate-900/10 bg-white/60 px-4 py-3 pl-10 text-sm text-slate-950 outline-none focus:border-slate-900/20 focus:bg-white/70"
            placeholder={t("ja", "search.placeholder")}
          />
        </div>
      </div>
    </div>

    <div class="md:col-span-4">
      <PreferencesPanel lang="ja" />
    </div>
  </section>

  <section class="mt-4">
    <PostList posts={filtered} lang="ja" />
    <div id="acg-list-empty" class="mt-4 glass shine rounded-2xl p-8 hidden">
      <div class="flex flex-col items-center gap-3 text-center">
        <div class="radar grid size-16 place-items-center shadow-sm">
          <span class="text-sm font-bold text-white/90">?</span>
        </div>
        <div>
          <div class="text-sm font-semibold text-slate-950">{t("ja", "search.emptyTitle")}</div>
          <div class="mt-2 text-xs leading-relaxed text-slate-600">{t("ja", "search.emptyHint")}</div>
        </div>
        <button
          type="button"
          id="acg-clear-search"
          class="rounded-xl bg-slate-950 px-4 py-2 text-xs font-medium text-white clickable"
        >
          {t("ja", "search.clear")}
        </button>
      </div>
    </div>
  </section>
</SiteLayout>
